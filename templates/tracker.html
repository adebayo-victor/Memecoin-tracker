<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto Tracker Dashboard</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: radial-gradient(circle at top right, #1a1c2c, #090a0f);
            background-attachment: fixed;
            color: #ffffff;
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 1.5rem;
        }

        .input-field {
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.15);
            transition: all 0.3s ease;
        }

        .input-field:focus {
            border-color: rgba(255, 255, 255, 0.5);
            outline: none;
        }

        .hidden-section { display: none; }

        .wallet-option { transition: transform 0.2s ease, background 0.2s ease; cursor: pointer; }
        .wallet-option:active { transform: scale(0.98); }

        /* Modal Overlay */
        .modal-overlay {
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
            position: fixed;
            inset: 0;
            z-index: 60;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1.5rem;
        }

        /* Toast notifications */
        .toast {
            position: fixed;
            top: 2rem;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
            padding: 1rem 1.5rem;
            border-radius: 1rem;
            font-size: 0.875rem;
            font-weight: 600;
            transition: all 0.3s ease;
            opacity: 0;
            pointer-events: none;
            box-shadow: 0 10px 25px rgba(0,0,0,0.5);
        }
        .toast.show { opacity: 1; transform: translateX(-50%) translateY(10px); }
        
        /* Custom scrollbar for glass panels */
        .glass-panel::-webkit-scrollbar { width: 4px; }
        .glass-panel::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 10px; }
    </style>
</head>
<body class="min-h-screen pb-24">

    <!-- Toast Notification System -->
    <div id="toast" class="toast glass-panel"></div>

    <div class="max-w-md mx-auto px-6 pt-10">
        
        <!-- SECTION: WALLET VIEW -->
        <div id="wallet_section" class="hidden-section">
            <h2 class="text-center text-xs tracking-[0.3em] font-bold opacity-70 mb-8 uppercase">Wallet Management</h2>
            
            <div class="grid grid-cols-2 gap-4 mb-8">
                <!-- Add Wallet Trigger -->
                <button id="btn_open_add_modal" class="wallet-option glass-panel p-6 flex flex-col items-center justify-center text-center hover:bg-white/5">
                    <div class="w-10 h-10 rounded-full bg-green-500/10 flex items-center justify-center text-green-500 mb-3">
                        <i class="fa-solid fa-plus"></i>
                    </div>
                    <p class="text-[11px] font-bold uppercase tracking-tight">Add Wallet</p>
                </button>

                <!-- Remove Wallet Trigger -->
                <button id="btn_open_remove_modal" class="wallet-option glass-panel p-6 flex flex-col items-center justify-center text-center hover:bg-white/5">
                    <div class="w-10 h-10 rounded-full bg-red-500/10 flex items-center justify-center text-red-500 mb-3">
                        <i class="fa-solid fa-trash-can"></i>
                    </div>
                    <p class="text-[11px] font-bold uppercase tracking-tight">Remove Wallet</p>
                </button>

                <!-- Change Tag Trigger -->
                <button id="btn_open_change_modal" class="wallet-option glass-panel p-6 flex flex-col items-center justify-center text-center hover:bg-white/5">
                    <div class="w-10 h-10 rounded-full bg-blue-500/10 flex items-center justify-center text-blue-500 mb-3">
                        <i class="fa-solid fa-pen-to-square"></i>
                    </div>
                    <p class="text-[11px] font-bold uppercase tracking-tight">Change Tag</p>
                </button>

                <!-- Load Wallets Trigger -->
                <button id="btn_load_wallets" class="wallet-option glass-panel p-6 flex flex-col items-center justify-center text-center hover:bg-white/5 group">
                    <div id="load_icon_container" class="w-10 h-10 rounded-full bg-purple-500/10 flex items-center justify-center text-purple-500 mb-3">
                        <i id="load_icon" class="fa-solid fa-cloud-arrow-down"></i>
                    </div>
                    <p id="load_text" class="text-[11px] font-bold uppercase tracking-tight">Load Wallets</p>
                </button>
            </div>

            <!-- WALLET LIST (NOW ON WALLET PAGE) -->
            <div class="mb-8">
                <h3 class="text-center text-[10px] tracking-[0.2em] font-semibold opacity-60 mb-4 uppercase">Your Wallets</h3>
                <div class="glass-panel overflow-hidden">
                    <div class="max-h-[300px] overflow-y-auto">
                        <table class="w-full text-left text-[11px]">
                            <tbody id="wallet_list_page_body" class="divide-y divide-white/5">
                                <tr>
                                    <td class="p-8 text-center opacity-30 italic">No wallets synced.</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- MODALS -->
        <!-- Add Modal -->
        <div id="add_modal_overlay" class="modal-overlay hidden">
            <div class="glass-panel w-full max-w-sm p-8 relative">
                <button onclick="closeModals()" class="absolute top-4 right-4 opacity-40 hover:opacity-100"><i class="fa-solid fa-xmark text-xl"></i></button>
                <h3 class="text-sm font-bold uppercase tracking-widest mb-6 text-center">Add New Wallet</h3>
                <form id="add_wallet_form" class="space-y-4">
                    <input type="text" id="wallet_address" required placeholder="Address (0x...)" class="input-field w-full rounded-xl px-4 py-3 text-sm text-white">
                    <input type="text" id="wallet_tag" required placeholder="Tag (e.g. Whale 1)" class="input-field w-full rounded-xl px-4 py-3 text-sm text-white">
                    <button type="submit" class="w-full bg-white text-black font-bold py-3 rounded-xl text-sm flex items-center justify-center gap-2">
                        <span class="btn-text">CONFIRM ADD</span>
                        <div class="btn-loader hidden animate-spin h-4 w-4 border-2 border-black border-t-transparent rounded-full"></div>
                    </button>
                </form>
            </div>
        </div>

        <!-- Remove Modal -->
        <div id="remove_modal_overlay" class="modal-overlay hidden">
            <div class="glass-panel w-full max-w-sm p-8 relative">
                <button onclick="closeModals()" class="absolute top-4 right-4 opacity-40 hover:opacity-100"><i class="fa-solid fa-xmark text-xl"></i></button>
                <h3 class="text-sm font-bold uppercase tracking-widest mb-6 text-center text-red-400">Remove Wallet</h3>
                <form id="remove_wallet_form" class="space-y-4">
                    <input type="text" id="remove_wallet_tag" required placeholder="Enter tag to remove" class="input-field w-full rounded-xl px-4 py-3 text-sm text-white">
                    <button type="submit" class="w-full bg-red-500 text-white font-bold py-3 rounded-xl text-sm flex items-center justify-center gap-2">
                        <span class="btn-text">CONFIRM REMOVE</span>
                        <div class="btn-loader hidden animate-spin h-4 w-4 border-2 border-white border-t-transparent rounded-full"></div>
                    </button>
                </form>
            </div>
        </div>

        <!-- Change Tag Modal -->
        <div id="change_modal_overlay" class="modal-overlay hidden">
            <div class="glass-panel w-full max-w-sm p-8 relative">
                <button onclick="closeModals()" class="absolute top-4 right-4 opacity-40 hover:opacity-100"><i class="fa-solid fa-xmark text-xl"></i></button>
                <h3 class="text-sm font-bold uppercase tracking-widest mb-6 text-center text-blue-400">Change Tag</h3>
                <form id="change_tag_form" class="space-y-4">
                    <input type="text" id="change_old_tag" required placeholder="Current Tag" class="input-field w-full rounded-xl px-4 py-3 text-sm text-white">
                    <input type="text" id="change_new_tag" required placeholder="New Tag" class="input-field w-full rounded-xl px-4 py-3 text-sm text-white">
                    <button type="submit" class="w-full bg-blue-500 text-white font-bold py-3 rounded-xl text-sm flex items-center justify-center gap-2">
                        <span class="btn-text">UPDATE TAG</span>
                        <div class="btn-loader hidden animate-spin h-4 w-4 border-2 border-white border-t-transparent rounded-full"></div>
                    </button>
                </form>
            </div>
        </div>

        <!-- SECTION: TRACKER VIEW (Default) -->
        <div id="tracker_section">
            <div class="text-center mb-8">
                <h2 class="text-xs tracking-[0.3em] font-bold opacity-70 mb-6 uppercase">Tracker</h2>
                <div class="glass-panel p-6 text-left">
                    <p class="text-sm leading-relaxed mb-4">
                        <span class="opacity-80">Wallet:</span> <strong>"Degeneric"</strong> <span class="text-xs opacity-50">(0xAb...c156)</span> <br>
                        <span class="opacity-80">transacted</span> <span class="text-lg font-bold block mt-1">1,000,000 $MOONROCK</span>
                    </p>
                    <div class="grid grid-cols-2 gap-3 mb-4">
                        <div>
                            <label class="text-[10px] uppercase tracking-wider opacity-50 block mb-1">Track Duration</label>
                            <input type="number" placeholder="60" class="input-field w-full rounded-lg px-3 py-2 text-sm text-white">
                        </div>
                        <div>
                            <label class="text-[10px] uppercase tracking-wider opacity-50 block mb-1">Ping Rate</label>
                            <input type="number" placeholder="2" class="input-field w-full rounded-lg px-3 py-2 text-sm text-white">
                        </div>
                    </div>
                    <button class="w-full bg-white text-black font-bold py-3 rounded-xl text-sm hover:bg-gray-200 transition">
                        START TRACKING
                    </button>
                </div>
            </div>

            <div class="mb-8">
                <h3 class="text-center text-[10px] tracking-[0.2em] font-semibold opacity-60 mb-4 uppercase">Live Track Feed</h3>
                <div class="glass-panel overflow-hidden">
                    <table class="w-full text-left text-[11px]">
                        <thead>
                            <tr class="border-b border-white/10 opacity-50">
                                <th class="p-4 font-medium uppercase">Tag</th>
                                <th class="p-4 font-medium uppercase">Address</th>
                            </tr>
                        </thead>
                        <tbody id="wallet_table_body" class="divide-y divide-white/5">
                            <tr>
                                <td colspan="2" class="p-8 text-center opacity-30 italic">No activity data.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- OTHER SECTIONS -->
        <div id="user_section" class="hidden-section">
            <h3 class="text-center text-[10px] tracking-[0.2em] font-semibold opacity-60 mb-4 uppercase">User Information</h3>
            <div class="glass-panel p-6 space-y-4">
                <input type="text" placeholder="Username" class="input-field w-full rounded-xl px-4 py-3 text-white">
                <button class="w-full border-2 border-white/40 text-white font-bold py-3 rounded-xl text-sm hover:bg-white/10 transition">SAVE PROFILE</button>
            </div>
        </div>

        <div id="starred_section" class="hidden-section">
            <h3 class="text-center text-[10px] tracking-[0.2em] font-semibold opacity-60 mb-4 uppercase">Starred Assets</h3>
            <p class="text-center opacity-30 text-xs py-10 italic">No starred assets yet.</p>
        </div>
    </div>

    <!-- NAVIGATION BAR -->
    <nav class="fixed bottom-0 left-0 right-0 bg-black/80 backdrop-blur-lg border-t border-white/10 px-6 py-4 z-50">
        <div class="max-w-md mx-auto flex justify-between items-center text-[10px] font-bold tracking-tighter">
            <button id="nav_wallet" class="flex flex-col items-center opacity-40 hover:opacity-100 transition">
                <i class="fa-solid fa-wallet text-lg mb-1"></i>
                <span>WALLET</span>
            </button>
            <button id="nav_tracker" class="flex flex-col items-center text-white">
                <i class="fa-solid fa-chart-line text-lg mb-1"></i>
                <span>TRACKER</span>
            </button>
            <button id="nav_user" class="flex flex-col items-center opacity-40 hover:opacity-100 transition">
                <i class="fa-solid fa-user-gear text-lg mb-1"></i>
                <span>USER TRACKER</span>
            </button>
            <button id="starred_user" class="flex flex-col items-center opacity-40 hover:opacity-100 transition">
                <i class="fa-solid fa-star text-lg mb-1"></i>
                <span>STARRED</span>
            </button>
        </div>
    </nav>

    <script>
        // DOM ELEMENTS
        const navBtns = {
            wallet: document.getElementById("nav_wallet"),
            tracker: document.getElementById("nav_tracker"),
            user: document.getElementById("nav_user"),
            starred: document.getElementById("starred_user")
        };
        const sections = {
            wallet: document.getElementById("wallet_section"),
            tracker: document.getElementById("tracker_section"),
            user: document.getElementById("user_section"),
            starred: document.getElementById("starred_section")
        };

        const modals = {
            add: document.getElementById("add_modal_overlay"),
            remove: document.getElementById("remove_modal_overlay"),
            change: document.getElementById("change_modal_overlay")
        };

        // NAVIGATION LOGIC
        function showSection(key) {
            Object.keys(sections).forEach(s => sections[s].classList.add("hidden-section"));
            Object.keys(navBtns).forEach(b => {
                navBtns[b].classList.remove("text-white");
                navBtns[b].classList.add("opacity-40");
            });
            sections[key].classList.remove("hidden-section");
            navBtns[key].classList.remove("opacity-40");
            navBtns[key].classList.add("text-white");
        }

        Object.keys(navBtns).forEach(key => navBtns[key].addEventListener("click", () => showSection(key)));

        // MODAL TOGGLES
        function closeModals() { Object.values(modals).forEach(m => m.classList.add("hidden")); }
        document.getElementById("btn_open_add_modal").onclick = () => modals.add.classList.remove("hidden");
        document.getElementById("btn_open_remove_modal").onclick = () => modals.remove.classList.remove("hidden");
        document.getElementById("btn_open_change_modal").onclick = () => modals.change.classList.remove("hidden");

        window.onclick = (e) => { if (Object.values(modals).includes(e.target)) closeModals(); };

        // TOAST SYSTEM
        function showToast(message, type = 'info') {
            const toast = document.getElementById("toast");
            toast.innerText = message;
            toast.style.color = type === 'error' ? '#f87171' : (type === 'success' ? '#4ade80' : '#fff');
            toast.classList.add("show");
            setTimeout(() => toast.classList.remove("show"), 3000);
        }

        // LOAD WALLETS LOGIC
        document.getElementById("btn_load_wallets").addEventListener("click", async () => {
            const icon = document.getElementById("load_icon");
            const text = document.getElementById("load_text");
            
            icon.classList.add("fa-spin");
            text.textContent = "SYNCING...";

            try {
                const response = await fetch("/load_wallets", { method: "POST" });
                const result = await response.json();

                if (result.status_code === "200") {
                    renderWallets(result.data.wallets);
                    showToast(result.message || "Wallets synced", "success");
                } else {
                    showToast(result.error || "Failed to load", "error");
                }
            } catch (err) {
                showToast("Connection error", "error");
            } finally {
                icon.classList.remove("fa-spin");
                text.textContent = "Load Wallets";
            }
        });

        function renderWallets(wallets) {
            const listBody = document.getElementById("wallet_list_page_body");
            const trackerBody = document.getElementById("wallet_table_body");

            if (!wallets || wallets.length === 0) {
                const emptyMsg = `<tr><td colspan="2" class="p-8 text-center opacity-30 italic">No wallets found.</td></tr>`;
                listBody.innerHTML = emptyMsg;
                trackerBody.innerHTML = emptyMsg;
                return;
            }

            const html = wallets.map(w => `
                <tr class="hover:bg-white/5 transition-colors group">
                    <td class="p-4">
                        <div class="font-bold text-white/90 text-xs">${w.tag}</div>
                        <div class="text-[10px] opacity-40 font-mono mt-0.5">${w.address.slice(0, 10)}...${w.address.slice(-8)}</div>
                    </td>
                    <td class="p-4 text-right">
                        <button onclick="navigator.clipboard.writeText('${w.address}'); showToast('Copied!')" class="opacity-30 hover:opacity-100 text-blue-400 transition-opacity">
                            <i class="fa-solid fa-copy"></i>
                        </button>
                    </td>
                </tr>
            `).join('');

            // Update both views
            listBody.innerHTML = html;
            trackerBody.innerHTML = html;
        }

        // GENERIC FORM HANDLER
        async function handleFormSubmit(url, body, formElement) {
            const btnText = formElement.querySelector(".btn-text");
            const btnLoader = formElement.querySelector(".btn-loader");
            const originalText = btnText.textContent;

            btnText.textContent = "WORKING...";
            btnLoader.classList.remove("hidden");

            try {
                const response = await fetch(url, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(body)
                });
                const result = await response.json();

                if (result.status_code === "200") {
                    showToast(result.message || "Done", "success");
                    formElement.reset();
                    closeModals();
                    // Re-load wallets to refresh list
                    document.getElementById("btn_load_wallets").click();
                } else {
                    showToast(result.error || "Error occurred", "error");
                }
            } catch (err) {
                showToast("Connection failed", "error");
            } finally {
                btnText.textContent = originalText;
                btnLoader.classList.add("hidden");
            }
        }

        document.getElementById("add_wallet_form").onsubmit = (e) => {
            e.preventDefault();
            handleFormSubmit("https://memecoin-tracker.onrender.com/add_wallet", { 
                address: document.getElementById("wallet_address").value, 
                tag: document.getElementById("wallet_tag").value 
            }, e.target);
        };

        document.getElementById("remove_wallet_form").onsubmit = (e) => {
            e.preventDefault();
            handleFormSubmit("https://memecoin-tracker.onrender.com/remove_wallet", { 
                tag: document.getElementById("remove_wallet_tag").value 
            }, e.target);
        };

        document.getElementById("change_tag_form").onsubmit = (e) => {
            e.preventDefault();
            handleFormSubmit("https://memecoin-tracker.onrender.com/change_tag", { 
                tag: document.getElementById("change_old_tag").value,
                new_tag: document.getElementById("change_new_tag").value 
            }, e.target);
        };

        // On Load
        window.onload = () => {
            showSection("tracker");
        };
    </script>
</body>
</html>